# @orchestr8/testkit - Comprehensive Task List

## ðŸš¨ Priority 0: Critical Security Fixes (IMMEDIATE - Block v1.0.3)

### Command Injection Prevention
- [x] Create `packages/testkit/src/security/index.ts` module âœ…
  - [x] Implement `sanitizeCommand()` function with shell metacharacter escaping âœ…
  - [x] Implement `validateCommand()` with allowlist validation âœ…
  - [x] Add comprehensive tests for command sanitization âœ…
- [x] Fix `packages/testkit/src/cli/spawn.ts:84-85` âœ…
  - [x] Apply command sanitization to all spawn operations âœ…
  - [x] Add validation for command arguments âœ…
  - [x] Update tests to verify security measures âœ…

### Path Traversal Prevention
- [x] Update `packages/testkit/src/fs/core.ts` âœ…
  - [x] Implement `validatePath()` function for all file operations âœ…
  - [x] Fix vulnerable join() calls at lines 96, 107, 113, 117, 137 âœ…
  - [x] Add boundary checks for temp directory operations âœ…
  - [x] Create tests for path traversal attempts âœ…

### SQL Injection Prevention
- [x] Review `packages/testkit/src/sqlite/*.ts` âœ…
  - [x] Implement parameterized queries for all SQL operations âœ…
  - [x] Add input validation for database names and table names âœ…
  - [x] Create SQL injection test suite âœ…

## ðŸ”´ Priority 1: Critical Bugs & Test Coverage (Before v1.0.3)

### Test Coverage for Fixed Functions
- [x] Add tests for `createMockFn()` in utils âœ…
  - [x] Test vitest detection logic âœ…
  - [x] Test fallback implementation âœ…
  - [x] Test mock tracking capabilities âœ…
- [x] Add tests for `retry()` exponential backoff âœ…
  - [x] Verify delay progression (100ms, 200ms, 400ms) âœ…
  - [x] Test max attempts behavior âœ…
  - [x] Test error propagation âœ…
- [x] Add tests for `withTimeout()` âœ…
  - [x] Verify timeout error message format âœ…
  - [x] Test promise resolution/rejection âœ…
  - [x] Test cleanup on timeout âœ…

### Zero Coverage Modules
- [x] Add comprehensive tests for `packages/testkit/src/config/` âœ…
  - [x] Test all 16 exported functions âœ…
  - [x] Test environment detection logic âœ…
  - [x] Test configuration merging âœ…
  - [x] Achieve minimum 80% coverage âœ…
- [x] Add tests for `packages/testkit/src/containers/` âœ…
  - [x] Test PostgresContainer class âœ…
  - [x] Test MySQLContainer class âœ…
  - [x] Test container lifecycle management âœ…
  - [x] Test error scenarios âœ…

### Resource Management
- [x] Create `packages/testkit/src/resources/manager.ts` âœ…
  - [x] Implement ResourceManager class âœ…
  - [x] Add automatic cleanup registration âœ…
  - [x] Handle cleanup errors gracefully âœ…
- [x] Fix process event listener leaks âœ…
  - [x] Add listener tracking in ProcessListenerManager âœ…
  - [x] Implement automatic removal on cleanup âœ…
  - [x] Add tests for leak prevention âœ…
- [x] Fix file descriptor leaks âœ…
  - [x] Add `registerFileDescriptor()` to ResourceManager âœ…
  - [x] Automatic cleanup on process exit âœ…
  - [x] Add resource counting tests âœ…

## ðŸŸ¡ Priority 2: Performance Optimizations (Before v1.1.0)

### Async Operations
- [x] Replace synchronous operations âœ…
  - [x] Convert `execSync` to `exec` with promises in scripts âœ…
  - [x] Made cleanup-teardown.ts fully async âœ…
  - [x] Made performance-monitor.ts fully async âœ…
- [x] Add concurrency control âœ…
  - [x] Implement p-limit for batch operations âœ…
  - [x] Add configurable concurrency limits âœ…
  - [x] Prevent memory pressure from unbounded operations âœ…

### Database Performance
- [x] Implement SQLite connection pooling âœ…
  - [x] Create connection pool manager âœ…
  - [x] Add pool size configuration âœ…
  - [x] Implement connection recycling âœ…
- [x] Add shared cache mode âœ…
  - [x] Enable cache=shared for SQLite âœ…
  - [x] Add cache configuration options âœ…
  - [x] Test performance improvements âœ…

### Memory Optimization
- [x] Reduce memory allocations âœ…
  - [x] Implement object pooling for frequent allocations âœ…
  - [x] Add BufferPool, ArrayPool, and PromisePool âœ…
  - [x] Add memory profiling tests âœ…
- [x] Fix memory leaks âœ…
  - [x] Clear all timers and intervals âœ…
  - [x] Remove all event listeners âœ…
  - [x] Implement weak references where appropriate âœ…

## ðŸŸ  Priority 3: API Consistency & DX (Before v2.0.0)

### Naming Standardization
- [x] Standardize function prefixes âœ…
  - [x] `create*` - Factory functions returning instances âœ…
  - [x] `setup*` - One-time initialization with side effects âœ…
  - [x] `use*` - Hook-style functions for test lifecycle âœ…
  - [x] `with*` - Scoped operations with cleanup âœ…
  - [x] `get*` - Pure getters without side effects âœ…
- [x] Fix inconsistent naming âœ…
  - [x] Rename conflicting functions âœ…
  - [x] Add deprecation warnings for old names âœ…
  - [x] Update all documentation âœ…

### Error Handling
- [x] Create base error classes âœ…
  - [x] Implement `TestkitError` base class âœ…
  - [x] Add error codes and categories âœ…
  - [x] Standardize error messages âœ…
- [x] Update all modules to use structured errors âœ…
  - [x] Replace plain Error throws âœ…
  - [x] Add error context and metadata âœ…
  - [x] Implement error serialization âœ…

### Breaking Changes Management
- [x] Add CommonJS compatibility âœ…
  - [x] Add "require" export conditions âœ…
  - [x] Test with CJS consumers âœ…
  - [x] Document dual package hazards âœ…
- [x] Remove deprecated APIs âœ…
  - [x] Remove deprecated auth methods âœ…
  - [x] Clean up legacy exports âœ…
  - [x] Update migration guide âœ…

## ðŸ”µ Priority 4: Documentation & Quality (Ongoing)

### Documentation
- [ ] Test all README examples
  - [ ] Create example test suite
  - [ ] Automate example validation
  - [ ] Fix broken examples
- [ ] Create comprehensive guides
  - [ ] Getting started guide
  - [ ] Migration from v1.0.x guide
  - [ ] API reference documentation
  - [ ] Best practices guide
- [ ] Add JSDoc comments
  - [ ] Document all public APIs
  - [ ] Add @example tags
  - [ ] Include @since version tags

### Code Quality
- [ ] Remove all `any` types (9 occurrences)
  - [ ] Add proper type definitions
  - [ ] Use generics where appropriate
  - [ ] Enable strict TypeScript checks
- [ ] Fix module boundaries
  - [ ] Remove circular dependencies
  - [ ] Clarify module responsibilities
  - [ ] Update import/export structure
- [ ] Improve test quality
  - [ ] Replace timing-dependent tests (40+ occurrences)
  - [ ] Add integration test suite
  - [ ] Improve test isolation
  - [ ] Add property-based tests

### CI/CD Improvements
- [ ] Add coverage gates
  - [ ] Fail CI if coverage < 70%
  - [ ] Add per-module coverage requirements
  - [ ] Generate coverage badges
- [ ] Add security scanning
  - [ ] Integrate dependency scanning
  - [ ] Add SAST tools
  - [ ] Automate security updates
- [ ] Add performance benchmarks
  - [ ] Create benchmark suite
  - [ ] Track performance over time
  - [ ] Fail on performance regressions

## ðŸ“Š Success Metrics

### Version 1.0.3 Release Criteria
- âœ… All security vulnerabilities fixed
- âœ… Test coverage > 60%
- âœ… All P0 and P1 tasks complete
- âœ… No memory leaks in core paths
- âœ… PR #114 fixes tested

### Version 1.1.0 Release Criteria
- âœ… Test coverage > 80%
- âœ… All P2 tasks complete
- âœ… Performance improvements verified
- âœ… No synchronous blocking operations
- âœ… Connection pooling implemented

### Version 2.0.0 Release Criteria
- âœ… All P3 tasks complete
- âœ… API fully standardized
- âœ… Breaking changes documented
- âœ… Migration guide complete
- âœ… Test coverage > 90%

## ðŸŽ¯ Task Assignment Suggestions

### Immediate (This Week)
1. Security fixes (P0) - Senior developer
2. Test coverage for utils (P1) - Any developer
3. Resource manager implementation (P1) - Senior developer

### Next Sprint
1. Config module tests (P1) - Mid-level developer
2. Async operation conversion (P2) - Senior developer
3. SQLite pooling (P2) - Database specialist

### Future Sprints
1. API standardization (P3) - Tech lead + team
2. Documentation (P4) - Technical writer + developers
3. Performance benchmarks (P4) - Performance engineer

## ðŸ“ˆ Estimated Timeline

- **Week 1**: Security fixes + critical tests = v1.0.3-beta
- **Week 2-3**: Coverage improvements + resource management = v1.0.3
- **Week 4-6**: Performance optimizations = v1.1.0-beta
- **Week 7-10**: API standardization + breaking changes = v2.0.0-alpha
- **Week 11-12**: Final testing + documentation = v2.0.0

## ðŸš€ Quick Start Commands

```bash
# Run security audit
pnpm --filter @orchestr8/testkit audit

# Run test coverage
pnpm --filter @orchestr8/testkit test:coverage

# Run performance benchmarks (after creation)
pnpm --filter @orchestr8/testkit bench

# Validate all examples (after creation)
pnpm --filter @orchestr8/testkit test:examples
```

---

**Last Updated**: 2025-09-30
**Total Tasks**: 95
**Critical (P0)**: 12
**High (P1)**: 23
**Medium (P2)**: 25
**Low (P3-P4)**: 35